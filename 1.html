<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Active Senior Dream Journey - DoDream</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- A-Frame -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap" rel="stylesheet">

    <style>
        body { 
          font-family: 'Noto Sans KR', sans-serif; 
          margin: 0; 
          padding: 0; 
          overflow: hidden; 
          background-color: #111; 
        }
        
        /* Animations */
        @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }
        .animate-fade-in { animation: fade-in 0.5s ease-out; }

        @keyframes slide-up-fade { from { opacity: 0; transform: translateY(50px) scale(0.95); } to { opacity: 1; transform: translateY(0) scale(1); } }
        .animate-slide-up-fade { animation: slide-up-fade 0.4s cubic-bezier(0.16, 1, 0.3, 1); }

        @keyframes slide-down { from { transform: translateY(-100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .animate-slide-down { animation: slide-down 0.4s cubic-bezier(0.16, 1, 0.3, 1); }

        @keyframes scale-in-top-right { from { opacity: 0; transform: scale(0.5); transform-origin: top right; } to { opacity: 1; transform: scale(1); transform-origin: top right; } }
        .animate-scale-in-tr { animation: scale-in-top-right 0.3s cubic-bezier(0.16, 1, 0.3, 1); }

        @keyframes pulse-ring {
            0% { transform: scale(0.8); opacity: 0.5; }
            100% { transform: scale(1.3); opacity: 0; }
        }
        .animate-pulse-ring::before {
            content: '';
            position: absolute;
            left: 0; top: 0; right: 0; bottom: 0;
            border-radius: 50%;
            border: 2px solid #84cc16; /* lime-500 */
            animation: pulse-ring 2s infinite;
        }

        /* Scrollbar Hide */
        .scrollbar-hide::-webkit-scrollbar { display: none; } 
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }

        /* AR Mode Transitions */
        .app-container {
            transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        .mode-normal {
            transform: none;
            border-radius: 0;
        }

        .mode-ar {
            transform: scale(1);
            border-radius: 32px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }
        
        /* Custom Range Slider for AR Scale */
        input[type=range] {
            -webkit-appearance: none;
            background: transparent; 
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #a3e635; /* lime-400 */
            cursor: pointer;
            margin-top: -6px; 
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        /* ---------------- Icons ---------------- */
        const Icon = ({ d, size = 24, className, ...props }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>
                {d.map((path, i) => <path key={i} d={path} />)}
            </svg>
        );

        const Bell = (p) => <Icon {...p} d={["M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9", "M13.73 21a2 2 0 0 1-3.46 0"]} />;
        const Settings = (p) => <Icon {...p} d={["M12.22 2h-.44a2 2 0 0 1-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z", "M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"]} />;
        const Home = (p) => <Icon {...p} d={["M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z", "M9 22V12h6v10"]} />;
        const MapIcon = (p) => <Icon {...p} d={["M1 6v14a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V6", "M8 2v4", "M16 2v4", "M12 2v20", "M3 10h18", "M3 14h18"]} />; 
        const Heart = (p) => <Icon {...p} d={["M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"]} {...(p.fill === "currentColor" ? { fill: "currentColor" } : {})} />;
        const User = (p) => <Icon {...p} d={["M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2", "M12 11a4 4 0 1 0 0-8 4 4 0 0 0 0 8z"]} />;
        const TrendingUp = (p) => <Icon {...p} d={["M23 6l-9.5 9.5-5-5L1 18", "M17 6h6v6"]} />;
        const Award = (p) => <Icon {...p} d={["M12 15c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3z", "M8.21 13.89L7 23l5-3 5 3-1.21-9.12"]} />;
        const Calendar = (p) => <Icon {...p} d={["M19 4H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2z", "M16 2v4", "M8 2v4", "M3 10h18"]} />;
        const Camera = (p) => <Icon {...p} d={["M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z", "M12 13a4 4 0 1 0 0-8 4 4 0 0 0 0 8z"]} />;
        const Check = (p) => <Icon {...p} d={["M20 6L9 17l-5-5"]} />;
        const X = (p) => <Icon {...p} d={["M18 6L6 18", "M6 6l12 12"]} />;
        const CreditCard = (p) => <Icon {...p} d={["M1 4h22v16H1z", "M1 10h22"]} />;
        const Moon = (p) => <Icon {...p} d={["M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"]} />;
        const Sun = (p) => <Icon {...p} d={["M12 1v2", "M12 21v2", "M4.22 4.22l1.42 1.42", "M18.36 18.36l1.42 1.42", "M1 12h2", "M21 12h2", "M4.22 19.78l1.42-1.42", "M18.36 5.64l1.42-1.42", "M12 17a5 5 0 1 0 0-10 5 5 0 0 0 0 10z"]} />;
        const Trash2 = (p) => <Icon {...p} d={["M3 6h18", "M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2", "M10 11v6", "M14 11v6"]} />;
        const Edit2 = (p) => <Icon {...p} d={["M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"]} />;
        const Save = (p) => <Icon {...p} d={["M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z", "M17 21v-8H7v8", "M7 3v5h8"]} />;
        const Mic = (p) => <Icon {...p} d={["M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z", "M19 10v2a7 7 0 0 1-14 0v-2", "M12 19v4", "M8 23h8"]} />;
        const MessageCircle = (p) => <Icon {...p} d={["M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"]} />;
        const Sparkles = (p) => <Icon {...p} d={["M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"]} />;
        const ChevronRight = (p) => <Icon {...p} d={["M9 18l6-6-6-6"]} />;
        const HelpCircle = (p) => <Icon {...p} d={["M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z", "M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3", "M12 17h.01"]} />;


        /* ============================================================
           AFRAME CUSTOM COMPONENTS (Interactions for AR scene)
        ============================================================ */
        AFRAME.registerComponent("hover-scale", {
            schema: { factor: { default: 1.2 } },
            init() {
                const el = this.el;
                el.addEventListener("mouseenter", () => {
                    el.object3D.scale.set(this.data.factor, this.data.factor, this.data.factor);
                });
                el.addEventListener("mouseleave", () => {
                    el.object3D.scale.set(1,1,1);
                });
            }
        });

        AFRAME.registerComponent("tap-animate", {
            schema: { color: { default: "#FFFFFF" } },
            init() {
                const el = this.el;
                el.addEventListener("click", () => {
                    el.setAttribute("animation__tap", {
                        property: "scale",
                        from: "1 1 1",
                        to: "1.3 1.3 1.3",
                        dur: 200,
                        dir: "alternate",
                        loop: false
                    });
                });
            }
        });

        /* ============================================================
           JOURNEY MAP 3D OBJECT (AR ì½˜í…ì¸  êµ¬í˜„)
        ============================================================ */
        function JourneyMapObject({ mapId }) {
            switch (mapId) {
                case 'map1':
                    return (
                        <a-entity>
                            <a-sky color="#0a2540"></a-sky>
                            <a-torus position="0 1.4 -3" radius="1" radius-tubular="0.05" color="#3B82F6" animation="property: rotation; to: 0 360 0; loop: true; dur: 6000; easing: linear"></a-torus>
                            <a-torus position="0 1.4 -3" radius="1.2" radius-tubular="0.05" color="#10B981" opacity="0.5" animation="property: rotation; to: 0 -360 0; loop: true; dur: 8000; easing: linear"></a-torus>
                            <a-cone position="0 1 -3" radius-bottom="1" radius-top="0.1" height="0.3" color="#93C5FD" opacity="0.9" animation="property: rotation; to: 0 360 0; loop: true; dur: 9000"></a-cone>
                            <a-text value="ì„±ì¥ â€¢ ì›°ë‹ˆìŠ¤" font="korean" position="0 0.3 -2.5" align="center" color="white" scale="2.5 2.5 2.5"></a-text>
                        </a-entity>
                    );
                case 'map2':
                    return (
                        <a-entity>
                            <a-sky color="#87CEEB"></a-sky>
                            <a-cone color="#8B5A2B" position="0 0.8 -3" radius-bottom="1.2" radius-top="0.2" height="1.5"></a-cone>
                            <a-cone color="#A0522D" position="0.8 0.6 -3.2" radius-bottom="0.9" radius-top="0.1" height="1.2"></a-cone>
                            <a-triangle color="#FFFFFF" position="-1 1.8 -2.8" scale="0.7 0.7 0.7" animation="property: position; to: 1 2.2 -3; dir: alternate; loop: true; dur: 3500; easing: easeInOutQuad"></a-triangle>
                            <a-cylinder color="#FFB74D" height="0.1" radius="0.6" position="0 0.5 -2.5" animation="property: rotation; to: 0 360 0; loop: true; dur: 8000"></a-cylinder>
                            <a-text value="ì—¬í–‰ â€¢ íƒí—˜" position="0 0.1 -2.3" align="center" color="white" scale="2.5 2.5 2.5"></a-text>
                        </a-entity>
                    );
                case 'map3':
                    return (
                        <a-entity>
                            <a-sky color="#FFF7ED"></a-sky>
                            <a-cylinder color="#FF7043" radius="0.6" height="0.3" position="0 1.2 -3"></a-cylinder>
                            <a-cone color="#F4511E" radius-bottom="0.7" radius-top="0.1" height="0.3" position="0 1.45 -3" animation="property: rotation; to: 0 360 0; loop: true; dur: 6000"></a-cone>
                            <a-cone color="#FF8A65" radius-bottom="0.2" radius-top="0.05" height="0.4" position="-0.8 1.7 -2.8" animation="property: position; to: -0.8 1.9 -2.8; dir: alternate; loop: true; dur: 2000"></a-cone>
                            <a-cylinder color="#795548" radius="0.05" height="0.7" position="0.6 1.7 -2.8" animation="property: rotation; to: 0 360 0; loop: true; dur: 5000"></a-cylinder>
                            <a-text value="ìš”ë¦¬ â€¢ ë”°ëœ»í•¨" position="0 0.3 -2.4" align="center" color="#333" scale="2.5 2.5 2.5"></a-text>
                        </a-entity>
                    );
                case 'map4':
                case 'map6': 
                    return (
                        <a-entity>
                            <a-sky color="#1A1033"></a-sky>
                            <a-entity position="0 1.3 -3" animation="property: rotation; to: 0 360 0; loop: true; dur: 6000">
                                <a-sphere radius="0.35" color="#A78BFA"></a-sphere>
                                <a-cylinder height="1" radius="0.08" position="0 0.8 0" color="#C084FC"></a-cylinder>
                            </a-entity>
                            <a-ring radius-inner="0.9" radius-outer="1.1" color="#9333EA" position="0 1 -3" animation="property: scale; to: 1.3 1.3 1; dir: alternate; loop: true; dur: 2000"></a-ring>
                            <a-text value="ìŒì•… â€¢ ë¦¬ë“¬" position="0 0.3 -2.4" align="center" color="white" scale="2.5 2.5 2.5"></a-text>
                        </a-entity>
                    );
                default:
                    return (
                        <a-entity>
                            <a-sky color="#222"></a-sky>
                            <a-text value="DoDream AR" color="white" position="0 1.5 -3" align="center"></a-text>
                        </a-entity>
                    );
            }
        }

        function ARTutorial() {
            return (
                <a-entity position="0 1.7 -2">
                    <a-text value="í™”ë©´ì„ í„°ì¹˜í•˜ì—¬ ì´ë™í•˜ì„¸ìš”" align="center" width="4" color="#FFFFFF" opacity="0.9" position="0 0.3 0" side="double"></a-text>
                    <a-ring radius-inner="0.2" radius-outer="0.3" color="#FFFFFF" opacity="0.6" animation="property: rotation; to: 0 360 0; loop: true; dur: 3000"></a-ring>
                </a-entity>
            );
        }

        function ARScene({ activeMap, onExit }) {
            return (
                <div style={{ position: "fixed", inset: 0, zIndex: 0, pointerEvents: "auto" }}>
                    <a-scene embedded vr-mode-ui="enabled: false" loading-screen="enabled: false" renderer="colorManagement: true; physicallyCorrectLights: true" style={{ width: "100%", height: "100%" }}>
                        <a-entity position="0 1.6 0"><a-camera look-controls="touchEnabled: true; magicWindowTrackingEnabled: true" wasd-controls-enabled="false"></a-camera></a-entity>
                        <a-entity light="type: ambient; color: #FFF; intensity: 0.7"></a-entity>
                        <a-entity light="type: directional; color:#FFF; intensity:0.6" position="1 3 2"></a-entity>
                        <a-entity geometry="primitive: plane; width: 60; height: 60" rotation="-90 0 0" material="color:#ffffff; opacity:0.05;"></a-entity>
                        <a-entity position="0 0 0"><JourneyMapObject mapId={activeMap ? activeMap.id : 'default'} /></a-entity>
                        <ARTutorial />
                    </a-scene>
                    <button onClick={onExit} style={{ position: "absolute", top: "20px", right: "20px", padding: "10px 16px", background: "rgba(0,0,0,0.6)", color: "#FFF", border: "1px solid rgba(255,255,255,0.3)", borderRadius: "10px", zIndex: 10000, fontWeight: "bold", backdropFilter: "blur(6px)" }}>AR ì¢…ë£Œ âœ•</button>
                </div>
            );
        }

        /* ---------------- Common UI Components ---------------- */
        function CommentInput({ onAdd, isDarkMode }) {
            const [text, setText] = useState('');
            return (
                <div className="mt-3 flex gap-2 items-center">
                    <div className="relative flex-1">
                        <input value={text} onChange={(e) => setText(e.target.value)} placeholder="ë”°ëœ»í•œ ëŒ“ê¸€ì„ ë‚¨ê²¨ì£¼ì„¸ìš”..." className={`w-full border rounded-xl pl-4 pr-12 py-4 text-base focus:ring-2 focus:ring-violet-500 outline-none transition-colors ${isDarkMode ? 'bg-slate-900 border-slate-700 text-white' : 'bg-slate-100 border-slate-200 text-slate-900'}`} />
                        <button onClick={() => alert("ìŒì„± ì¸ì‹ ì‹œë®¬ë ˆì´ì…˜")} className="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-lime-500 p-2"><Mic size={24} /></button>
                    </div>
                    <button onClick={() => { if (text.trim()) { onAdd(text.trim()); setText(''); } }} className="bg-lime-400 text-black font-bold px-5 py-4 rounded-xl whitespace-nowrap transition-transform active:scale-95">ë“±ë¡</button>
                </div>
            );
        }

        function ProfileEditor({ profile, onSave, isDarkMode }) {
            const [form, setForm] = useState(profile);
            const inputClass = `w-full p-3 rounded-lg border outline-none transition-colors ${isDarkMode ? 'bg-slate-900 border-slate-700 text-white' : 'bg-slate-50 border-slate-200 text-slate-900'}`;
            return (
                <div className={`p-4 rounded-xl animate-fade-in-up ${isDarkMode ? 'bg-slate-800' : 'bg-white shadow-sm border border-slate-100'}`}>
                    <h4 className={`font-bold mb-4 text-xl ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>í”„ë¡œí•„ ìˆ˜ì •</h4>
                    <div className="space-y-4">
                        <div><label className="block text-sm text-gray-400 mb-1">ì´ë¦„</label><input value={form.name} onChange={(e) => setForm((s) => ({ ...s, name: e.target.value }))} className={inputClass} /></div>
                        <div><label className="block text-sm text-gray-400 mb-1">ì´ë©”ì¼</label><input value={form.email} onChange={(e) => setForm((s) => ({ ...s, email: e.target.value }))} className={inputClass} /></div>
                        <div className="flex gap-3 mt-4">
                            <button onClick={() => onSave(form)} className="flex-1 bg-violet-600 text-white py-3 rounded-xl font-bold hover:bg-violet-500 transition-colors active:scale-95">ì €ì¥ ì™„ë£Œ</button>
                            <button onClick={() => setForm(profile)} className="flex-1 bg-gray-500 text-white py-3 rounded-xl font-bold hover:bg-gray-600 transition-colors active:scale-95">ì›ë˜ëŒ€ë¡œ</button>
                        </div>
                    </div>
                </div>
            );
        }

        function SplashScreen({ onFinish, isDarkMode }) {
            const [animate, setAnimate] = useState(false);
            useEffect(() => { setAnimate(true); const timer = setTimeout(() => onFinish(), 2500); return () => clearTimeout(timer); }, [onFinish]);
            return (
                <div className={`absolute inset-0 z-[20000] flex flex-col items-center justify-center transition-colors duration-500 ${isDarkMode ? 'bg-[#050b14]' : 'bg-slate-50'}`}>
                    <div className={`transform transition-all duration-1000 ease-out ${animate ? 'opacity-100 scale-100 translate-y-0' : 'opacity-0 scale-90 translate-y-10'}`}>
                        <svg width="180" height="90" viewBox="0 0 120 50" fill="none" className="drop-shadow-lg mb-4"><path d="M20 40 C 20 15, 100 15, 100 40" stroke="#10B981" strokeWidth="8" strokeLinecap="round" /><path d="M32 40 C 32 22, 88 22, 88 40" stroke="#FBBF24" strokeWidth="8" strokeLinecap="round" /><path d="M44 40 C 44 29, 76 29, 76 40" stroke="#3B82F6" strokeWidth="8" strokeLinecap="round" /></svg>
                        <div className={`text-3xl font-bold text-center tracking-tight ${isDarkMode ? 'text-white' : 'text-slate-900'}`} style={{ fontFamily: 'sans-serif' }}>DoDream</div>
                        <p className={`mt-4 text-base text-center animate-pulse ${isDarkMode ? 'text-gray-400' : 'text-gray-500'}`}>ë‹¹ì‹ ì˜ ê¿ˆì„ ì‘ì›í•©ë‹ˆë‹¤</p>
                    </div>
                </div>
            );
        }

        /* ---------------- Helper: Smoothed Line Chart ---------------- */
        const LineChart = ({ data, color }) => {
            const width = 100;
            const height = 40; // Reduced height
            const maxVal = 100;
            const minVal = 0;

            const points = data.map((d, i) => {
                const x = (i / (data.length - 1)) * width;
                const y = height - ((d.val - minVal) / (maxVal - minVal)) * height;
                return { x, y };
            });

            const getPath = () => {
                if (points.length === 0) return "";
                let d = `M ${points[0].x},${points[0].y}`;
                for (let i = 0; i < points.length - 1; i++) {
                    const curr = points[i];
                    const next = points[i+1];
                    const cp1x = curr.x + (next.x - curr.x) / 2;
                    const cp1y = curr.y;
                    const cp2x = curr.x + (next.x - curr.x) / 2;
                    const cp2y = next.y;
                    d += ` C ${cp1x},${cp1y} ${cp2x},${cp2y} ${next.x},${next.y}`;
                }
                return d;
            };

            const linePath = getPath();
            const areaPath = `${linePath} L ${width},${height} L 0,${height} Z`;
            const gradientId = "chartGradient";

            return (
                <div className="w-full h-32 flex flex-col justify-end relative px-2 pb-2">
                    <svg viewBox={`-2 0 ${width+4} ${height}`} className="w-full h-full overflow-visible" preserveAspectRatio="none">
                        <defs>
                            <linearGradient id={gradientId} x1="0" y1="0" x2="0" y2="1">
                                <stop offset="0%" stopColor="currentColor" className={color} stopOpacity="0.2" />
                                <stop offset="100%" stopColor="currentColor" className={color} stopOpacity="0.0" />
                            </linearGradient>
                        </defs>
                        <path d={areaPath} fill={`url(#${gradientId})`} />
                        <path d={linePath} fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" className={color} />
                    </svg>
                    <div className="flex justify-between mt-2 px-1">
                        {data.map((d, i) => <span key={i} className="text-sm text-gray-500 font-medium">{d.day}</span>)}
                    </div>
                </div>
            );
        };

        /* ---------------- Helper: Weather Card ---------------- */
        function WeatherCard({ isDarkMode, isARMode }) {
            const [time, setTime] = useState(new Date());
            const weatherData = { temp: 18, icon: 'â›…', desc: 'êµ¬ë¦„ ì¡°ê¸ˆ' };

            useEffect(() => {
                const timer = setInterval(() => setTime(new Date()), 1000);
                return () => clearInterval(timer);
            }, []);

            const hours = time.getHours().toString().padStart(2, '0');
            const minutes = time.getMinutes().toString().padStart(2, '0');
            const dateStr = time.toLocaleDateString('ko-KR', { month: 'long', day: 'numeric', weekday: 'long' });

            return (
                <div className={`rounded-3xl relative overflow-hidden shadow-lg transition-all ${isARMode ? 'p-4 h-32' : 'p-6 mb-6'}`}>
                    <div className="absolute inset-0 z-0">
                        <img src="https://images.unsplash.com/photo-1470252649378-9c29740c9fa8?q=80&w=1000&auto=format&fit=crop" className="w-full h-full object-cover opacity-90" alt="Weather Background" />
                        <div className="absolute inset-0 bg-gradient-to-b from-black/10 to-black/40"></div>
                    </div>
                    <div className={`relative z-10 text-white flex flex-col items-center justify-center h-full text-shadow ${isARMode ? 'py-0' : 'py-4'}`}>
                        {!isARMode && <div className="mb-2 opacity-80"><span className="text-sm border border-white/50 rounded-full px-3 py-1">Live Weather</span></div>}
                        <div className={`${isARMode ? 'text-4xl' : 'text-7xl'} font-bold tracking-tight mb-2 drop-shadow-lg`} style={{fontFamily: 'sans-serif'}}>{hours}:{minutes}</div>
                        <div className={`flex items-center gap-3 font-medium drop-shadow-md ${isARMode ? 'text-sm' : 'text-xl'}`}><span>{dateStr}</span><span className="opacity-80">|</span><span>{weatherData.icon} {weatherData.temp}Â°</span></div>
                    </div>
                </div>
            );
        }


        /* ---------------- Tab Component: HomeTab ---------------- */
        function HomeTab({ profile, missions, setMissions, progress, setProgress, isDarkMode, setIsDarkMode, activeToast, theme, setActiveTab, maps, handleJoinClick, notifications, setShowNotiPanel, showNotiPanel, isARMode }) {
            const [todayEmotion, setTodayEmotion] = useState(null);
            const [emotionNote, setEmotionNote] = useState("");
            const emotionList = ["ğŸ˜Š", "ğŸ™‚", "ğŸ˜", "ğŸ˜”", "ğŸ˜¢"];
            const emotionMessage = { "ğŸ˜Š": "ì¢‹ì€ í•˜ë£¨ë¥¼ ìœ„í•´ ê°€ë²¼ìš´ ìš”ê°€ë¥¼ ì¶”ì²œë“œë ¤ìš”.", "ğŸ™‚": "ê¸°ë¶„ì´ ì°¨ë¶„í•˜ì‹œêµ°ìš”. ì‚¬ì§„ ì‚°ì±…ë§µì€ ì–´ë– ì„¸ìš”?", "ğŸ˜": "ë¦¬í”„ë ˆì‹œê°€ í•„ìš”í•´ë³´ì—¬ìš”. ìŒì•…ë§µì´ ë„ì›€ì´ ë  ìˆ˜ ìˆì–´ìš”.", "ğŸ˜”": "ê´œì°®ì•„ìš”. ë§ˆìŒì„ ì•ˆì •ì‹œí‚¤ëŠ” ëª…ìƒë§µì„ ì¶”ì²œë“œë¦´ê²Œìš”.", "ğŸ˜¢": "í•¨ê»˜ ìˆì–´ë“œë¦´ê²Œìš”. ê°ì • íšŒë³µ ì—¬ì •ë§µì´ ìˆì–´ìš”." };
            
            const aiRecommendedMaps = useMemo(() => {
                return maps.sort(() => Math.random() - 0.5).slice(0, 3).map(m => ({ ...m, reason: "ì˜¤ëŠ˜ ê¸°ë¶„ê³¼ í™œë™ëŸ‰ì„ ê¸°ì¤€ìœ¼ë¡œ ì¶”ì²œí•©ë‹ˆë‹¤." }));
            }, [todayEmotion, missions, maps]);

            const [showTicket, setShowTicket] = useState(true);
            const neighborFeed = [{ id: 1, msg: "ë°•ì„ ìë‹˜ì´ ìƒˆë¡œìš´ ì—¬í–‰ ì‚¬ì§„ì„ ê³µìœ í–ˆìŠµë‹ˆë‹¤." }, { id: 2, msg: "ì€í˜œë‹˜ì´ ì˜¤ëŠ˜ì˜ ìš”ë¦¬ë§µì„ ì™„ì£¼í–ˆì–´ìš”!" }];

            const chartData = useMemo(() => {
                return Array.from({ length: 7 }, (_, i) => ({ day: ["ì›”", "í™”", "ìˆ˜", "ëª©", "ê¸ˆ", "í† ", "ì¼"][i], val: Math.floor(Math.random() * 40) + 40 }));
            }, []);

            return (
                <div className="p-4 animate-fade-in space-y-6 pb-32">
                    {/* Header */}
                    <div className="flex justify-between items-start pt-4 mb-2">
                         <div className="pt-2">
                             <svg width="160" height="60" viewBox="0 0 120 50" fill="none" className="drop-shadow-md">
                                <path d="M20 40 C 20 15, 100 15, 100 40" stroke="#10B981" strokeWidth="8" strokeLinecap="round" />
                                <path d="M32 40 C 32 22, 88 22, 88 40" stroke="#FBBF24" strokeWidth="8" strokeLinecap="round" />
                                <path d="M44 40 C 44 29, 76 29, 76 40" stroke="#3B82F6" strokeWidth="8" strokeLinecap="round" />
                                <text x="60" y="45" fontFamily="sans-serif" fontSize="20" fontWeight="bold" fill={isDarkMode ? "white" : "black"} textAnchor="middle">DoDream</text>
                            </svg>
                         </div>
                         
                         <div className="flex flex-col items-end relative">
                            <div className="flex gap-3 mb-3 items-center">
                                 {!isARMode && (
                                    <div className="text-right mr-1">
                                        <h1 className={`text-base font-bold ${theme.textMain}`}>{profile.name}ë‹˜,</h1>
                                        <p className={`text-xs ${theme.textSub}`}>ì˜¤ëŠ˜ë„ ê¿ˆ ì—¬ì •ì„ í•¨ê»˜ ê±¸ì–´ë³¼ê¹Œìš”?</p>
                                    </div>
                                 )}
                                <button onClick={() => alert("ë„ì›€ë§ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.")} className={`p-3 rounded-full ${theme.panel}`}><HelpCircle size={24}/></button>
                                <button onClick={() => setIsDarkMode(!isDarkMode)} className={`p-3 rounded-full ${theme.panel}`}>{isDarkMode ? <Sun size={24}/> : <Moon size={24}/>}</button>
                                <button onClick={() => setShowNotiPanel(!showNotiPanel)} className={`p-3 rounded-full relative ${theme.panel}`}><Bell size={24}/>{notifications.some(n => !n.read) && <span className="absolute top-2 right-2 w-3 h-3 bg-red-500 rounded-full border-2 border-white dark:border-slate-800"></span>}</button>
                            </div>
                            {showNotiPanel && (
                                <div className={`absolute top-14 right-0 w-72 rounded-2xl shadow-2xl overflow-hidden z-50 animate-scale-in-tr border ${isDarkMode ? 'bg-slate-800 border-slate-600' : 'bg-white border-slate-100'}`}>
                                    <div className={`p-3 border-b flex justify-between items-center ${isDarkMode ? 'bg-slate-900/50 border-slate-700 text-white' : 'bg-slate-50 border-slate-100 text-slate-900'}`}>
                                        <span className="font-bold text-sm">ì•Œë¦¼í•¨</span>
                                        <button onClick={() => setShowNotiPanel(false)}><X size={16} /></button>
                                    </div>
                                    <div className="max-h-60 overflow-y-auto">
                                        {notifications.length === 0 ? <div className={`p-4 text-center text-xs ${theme.textSub}`}>ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤.</div> : notifications.map((n) => (<div key={n.id} className={`p-3 border-b ${isDarkMode ? 'border-slate-700/50 hover:bg-slate-700/50 text-gray-200' : 'border-slate-100 hover:bg-slate-50 text-slate-800'}`}><div className="text-sm mb-1">{n.text}</div><div className={`text-xs ${theme.textSub}`}>{n.time}</div></div>))}
                                    </div>
                                </div>
                            )}
                         </div>
                    </div>

                    {/* AR Mode Greeting (only visible in AR mode) */}
                    {isARMode && (
                        <div className="mb-4 text-right px-1">
                            <h1 className={`text-xl font-bold ${theme.textMain}`}>{profile.name}ë‹˜,</h1>
                            <p className={`text-sm ${theme.textSub}`}>ì˜¤ëŠ˜ë„ ê¿ˆ ì—¬ì •ì„ í•¨ê»˜ ê±¸ì–´ë³¼ê¹Œìš”?</p>
                        </div>
                    )}

                    {/* Weather (Ambient) */}
                    <WeatherCard isDarkMode={isDarkMode} isARMode={isARMode} />

                    {/* Stats Grid (Today's Activity Summary) */}
                    <div className={`grid grid-cols-3 ${isARMode ? 'gap-2' : 'gap-4'}`}>
                        {[{ label:"í™œë™ ì˜¨ë„", val:`${progress}Â°C`, icon:TrendingUp }, { label:"ê¿ˆ í¬ì¸íŠ¸", val:"1,250", icon:Award }, { label:"ì—°ì† ê¸°ë¡", val:"12ì¼", icon:Calendar }].map((s, idx) => (
                            <div key={idx} className={`rounded-2xl flex flex-col items-center justify-center ${theme.panel} ${isARMode ? 'h-20 p-2' : 'p-5 h-32'}`}>
                                <s.icon size={isARMode ? 20 : 30} className={idx === 0 ? "text-red-500" : idx === 1 ? "text-yellow-500" : "text-blue-500"} />
                                <span className={`${isARMode ? 'text-[10px]' : 'text-sm'} ${theme.textSub} mt-2`}>ì˜¤ëŠ˜ì˜ {s.label}</span>
                                <span className={`font-bold ${isARMode ? 'text-sm' : 'text-2xl'} ${theme.textMain} mt-1`}>{s.val}</span>
                            </div>
                        ))}
                    </div>

                    {/* Grid: Emotion + Badges (Now at top) */}
                    <div className="grid grid-cols-2 gap-4">
                        <div className={`rounded-3xl ${isARMode ? 'p-3' : 'p-6'} ${theme.panel} flex flex-col justify-between`}>
                            <h3 className={`font-bold ${isARMode ? 'text-sm' : 'text-lg'} mb-3 ${theme.textMain}`}>ì˜¤ëŠ˜ì˜ ê°ì •ì€?</h3>
                            <div className={`flex justify-between ${isARMode ? 'text-2xl mb-2' : 'text-3xl mb-3'}`}>
                                {emotionList.map(e => (
                                    <button key={e} onClick={() => setTodayEmotion(e)} className={`transition transform hover:scale-110 active:scale-95 ${todayEmotion === e ? 'scale-125 drop-shadow-lg' : 'opacity-60 grayscale'}`}>{e}</button>
                                ))}
                            </div>
                            {todayEmotion ? <p className={`${isARMode ? 'text-xs' : 'text-sm'} ${theme.textSub} font-medium`}>{emotionMessage[todayEmotion]}</p> : <p className={`${isARMode ? 'text-xs' : 'text-sm'} text-gray-400`}>ê¸°ë¶„ì„ ì„ íƒí•´ì£¼ì„¸ìš”</p>}
                            <textarea placeholder="ê°„ë‹¨í•œ ê°ì • ë©”ëª¨ë¥¼ ë‚¨ê²¨ë³´ì„¸ìš”..." value={emotionNote} onChange={e => setEmotionNote(e.target.value)} className={`w-full rounded-xl border resize-none focus:outline-none focus:ring-2 focus:ring-lime-400 ${isARMode ? 'text-xs p-2' : 'text-base p-3'} ${isDarkMode ? 'bg-slate-900 border-slate-700 text-white' : 'bg-slate-50 border-slate-200 text-black'}`} rows={2} />
                        </div>

                        <div className={`rounded-3xl ${isARMode ? 'p-4' : 'p-6'} ${theme.panel} flex flex-col`}>
                            <h3 className={`font-bold ${isARMode ? 'text-sm' : 'text-lg'} mb-4 ${theme.textMain}`}>ì´ë²ˆ ì£¼ ë°°ì§€</h3>
                            <div className="flex gap-3 justify-center items-center h-full">
                                <div className="w-12 h-12 rounded-full bg-gradient-to-br from-yellow-200 to-orange-400 flex items-center justify-center text-2xl shadow-md">ğŸŒŸ</div>
                                <div className="w-12 h-12 rounded-full bg-gradient-to-br from-blue-200 to-cyan-400 flex items-center justify-center text-lg shadow-md">ğŸ’§</div>
                                <div className="w-12 h-12 rounded-full bg-gradient-to-br from-pink-200 to-rose-400 flex items-center justify-center text-lg shadow-md">ğŸŒ¸</div>
                            </div>
                        </div>
                    </div>

                    {/* Recommendations (Personalized) */}
                    <div className={`rounded-3xl p-6 ${theme.panel}`}>
                        <h3 className={`font-bold ${isARMode ? 'text-lg' : 'text-xl'} mb-4 ${theme.textMain}`}>ì˜¤ëŠ˜ì˜ AI ë§ì¶¤ ì—¬ì •</h3>
                        <div className="space-y-6">
                            {aiRecommendedMaps.map(map => (
                                <div key={map.id} className={`rounded-2xl overflow-hidden shadow-sm border ${isDarkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-100'}`}>
                                    <img src={map.img} className="w-full h-48 object-cover" />
                                    <div className="p-5">
                                        <div className="flex justify-between items-start">
                                            <h4 className={`font-bold ${isARMode ? 'text-base' : 'text-lg'} ${theme.textMain} mb-1`}>{map.title}</h4>
                                            <span className="text-xs bg-lime-100 text-lime-700 px-3 py-1 rounded-md font-bold">ì¶”ì²œ</span>
                                        </div>
                                        <p className={`${isARMode ? 'text-sm' : 'text-base'} text-gray-500 mt-1 mb-5 line-clamp-2`}>{map.reason}</p>
                                        <button onClick={() => handleJoinClick(map)} className={`w-full py-4 ${isARMode ? 'text-sm' : 'text-base'} bg-slate-900 text-white dark:bg-white dark:text-slate-900 rounded-xl font-bold active:scale-95 transition-transform`}>ì…ì¥í•˜ê¸°</button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Ticket */}
                    {showTicket && (
                        <div className={`rounded-3xl p-6 ${theme.panel} bg-gradient-to-br from-yellow-100 to-orange-50 border-none dark:from-yellow-900/20 dark:to-orange-900/20`}>
                            <h3 className={`font-bold ${isARMode ? 'text-lg' : 'text-xl'} mb-2 ${theme.textMain}`}>ì˜¤ëŠ˜ì˜ AR í‹°ì¼“ ğŸŸï¸</h3>
                            <p className={`${isARMode ? 'text-sm' : 'text-base'} text-gray-500 dark:text-gray-400 mb-5`}>ì˜¤ëŠ˜ ë°›ì„ ìˆ˜ ìˆëŠ” íŠ¹ë³„í•œ ë³´ìƒì…ë‹ˆë‹¤.</p>
                            <button onClick={() => setShowTicket(false)} className="w-full py-4 rounded-xl bg-gradient-to-r from-yellow-400 to-orange-400 text-white font-bold shadow-lg active:scale-95 transition-transform text-lg flex items-center justify-center gap-2">í‹°ì¼“ ì—´ê¸° ğŸ‰</button>
                        </div>
                    )}

                    {/* Missions */}
                    <div className={`rounded-3xl p-6 ${theme.panel}`}>
                        <h3 className={`font-bold ${isARMode ? 'text-lg' : 'text-xl'} mb-4 ${theme.textMain}`}>ì˜¤ëŠ˜ì˜ ë¯¸ì…˜</h3>
                        {missions.map(m => (
                            <div key={m.id} onClick={() => { const updated = missions.map(x => x.id === m.id ? { ...x, done: !x.done } : x); setMissions(updated); }} className="flex items-center gap-4 mb-4 cursor-pointer p-3 hover:bg-black/5 rounded-xl transition-colors">
                                <div className={`w-8 h-8 rounded-full border-2 flex items-center justify-center ${m.done ? 'bg-lime-400 border-lime-400' : 'border-gray-400'}`}>{m.done ? "âœ“" : ""}</div>
                                <span className={`${isARMode ? 'text-base' : 'text-lg'} ${theme.textMain} ${m.done ? 'line-through opacity-50' : ''}`}>{m.title}</span>
                            </div>
                        ))}
                    </div>

                    {/* Neighbor News */}
                    <div className={`rounded-3xl p-6 ${theme.panel}`}>
                        <h3 className={`font-bold ${isARMode ? 'text-lg' : 'text-xl'} mb-4 ${theme.textMain}`}>ì´ì›ƒ ì†Œì‹</h3>
                        <ul className="space-y-4">
                            {neighborFeed.map(n => <li key={n.id} className={`${isARMode ? 'text-sm' : 'text-base'} ${theme.textMain}`}>â€¢ {n.msg}</li>)}
                        </ul>
                    </div>

                    {/* Growth Curve */}
                    <div className={`rounded-3xl p-6 ${theme.panel}`}>
                        <h3 className={`font-bold ${isARMode ? 'text-lg' : 'text-xl'} mb-4 ${theme.textMain}`}>ë‚˜ì˜ 7ì¼ ì„±ì¥ ê³¡ì„ </h3>
                        <LineChart data={chartData} color="text-lime-500" />
                    </div>

                </div>
            );
        }

        /* ---------------- Tab Component: SettingsTab ---------------- */
        function SettingsTab({ profile, updateProfile, isDarkMode, setMypageSub, mypageSub, theme, posts }) {
            return (
                <div className="p-4 pb-24 animate-fade-in h-full overflow-y-auto">
                    <h2 className={`text-3xl font-bold mb-6 px-2 pt-2 ${theme.textMain}`}>ë§ˆì´í˜ì´ì§€</h2>
                    
                    <div className={`rounded-3xl p-6 mb-6 flex items-center gap-5 relative overflow-hidden ${theme.panel}`}>
                        <div className="w-24 h-24 rounded-full bg-gradient-to-tr from-lime-400 to-emerald-400 flex items-center justify-center text-black text-3xl font-bold shadow-lg">{profile.name[0]}</div>
                        <div>
                            <div className={`font-bold text-2xl mb-1 ${theme.textMain}`}>{profile.name} <span className="text-sm bg-violet-500/10 text-violet-500 border border-violet-200 px-3 py-0.5 rounded-full ml-2">Lv.{profile.level}</span></div>
                            <div className={`text-base mb-3 ${theme.textSub}`}>{profile.email}</div>
                            <button onClick={() => setMypageSub('profile')} className="text-base text-lime-500 font-bold flex items-center">í”„ë¡œí•„ í¸ì§‘ <ChevronRight size={20} /></button>
                        </div>
                    </div>

                    {mypageSub === 'main' ? (
                        <div className="grid grid-cols-2 gap-4">
                            {[{ id: 'profile', label: 'ë‚´ ì •ë³´', icon: 'ğŸ“', color: 'bg-blue-500/10 text-blue-500' }, 
                              { id: 'neighbors', label: 'ë‚´ ì´ì›ƒ', icon: 'ğŸ‘¥', color: 'bg-indigo-500/10 text-indigo-500' }, 
                              { id: 'myposts', label: 'ë‚´ ê²Œì‹œê¸€', icon: 'âœï¸', color: 'bg-pink-500/10 text-pink-500' }, 
                              { id: 'liked', label: 'ì¢‹ì•„ìš”', icon: 'â¤ï¸', color: 'bg-red-500/10 text-red-500' }, 
                              { id: 'achievements', label: 'ì„±ì·¨ ê¸°ë¡', icon: 'ğŸ†', color: 'bg-yellow-500/10 text-yellow-500' }, 
                              { id: 'journeymaps', label: 'ë‚´ ì—¬ì •', icon: 'ğŸ—ºï¸', color: 'bg-emerald-500/10 text-emerald-500' }, 
                              { id: 'payment', label: 'ê²°ì œ/ê³„ì¢Œ', icon: 'ğŸ’³', color: 'bg-teal-500/10 text-teal-500' }, 
                              { id: 'settings', label: 'ì„¤ì •', icon: 'âš™ï¸', color: 'bg-gray-500/10 text-gray-500' }
                            ].map((item) => (
                                <button key={item.id} onClick={() => setMypageSub(item.id)} className={`p-4 h-36 rounded-3xl flex flex-col items-center justify-center gap-3 transition-all hover:scale-[1.02] ${theme.panel} hover:opacity-90`}>
                                    <div className={`w-14 h-14 rounded-2xl flex items-center justify-center text-3xl ${item.color}`}>{item.icon === 'ğŸ’³' ? <CreditCard size={28} /> : item.icon}</div>
                                    <span className={`font-bold text-lg ${theme.textMain}`}>{item.label}</span>
                                </button>
                            ))}
                        </div>
                    ) : (
                        <div className={`rounded-3xl p-6 min-h-[300px] animate-slide-up-fade ${theme.panel}`}>
                            <button onClick={() => setMypageSub('main')} className={`mb-8 flex items-center gap-1 font-bold text-xl ${theme.textSub} hover:${theme.textMain}`}><ChevronRight size={28} className="rotate-180" /> ëŒì•„ê°€ê¸°</button>
                            
                            {mypageSub === 'profile' && <ProfileEditor profile={profile} onSave={updateProfile} isDarkMode={isDarkMode} />}
                            
                            {mypageSub === 'payment' && (
                                <div>
                                    <h4 className={`font-bold mb-6 text-2xl ${theme.textMain}`}>ê²°ì œ/ê³„ì¢Œ ê´€ë¦¬</h4>
                                    <div className="space-y-5">
                                        <div className={`p-5 rounded-2xl flex items-center justify-between border ${isDarkMode ? 'bg-slate-800 border-white/5' : 'bg-white border-slate-200'}`}>
                                            <div className="flex items-center gap-5">
                                                <div className="w-14 h-14 bg-blue-600 rounded-xl flex items-center justify-center font-bold text-base text-white">VISA</div>
                                                <div><div className={`font-bold text-lg ${theme.textMain}`}>ì‹ í•œì¹´ë“œ</div><div className={`text-base ${theme.textSub}`}>**** 1234</div></div>
                                            </div>
                                            <span className="text-sm bg-lime-500/20 text-lime-600 px-4 py-1.5 rounded-lg font-bold">ê¸°ë³¸</span>
                                        </div>
                                        <button className={`w-full py-6 border-2 border-dashed rounded-2xl flex items-center justify-center gap-2 text-lg font-bold transition-colors ${isDarkMode ? 'border-slate-600 text-gray-400 hover:text-white' : 'border-slate-300 text-slate-500 hover:text-slate-900'}`}>+ ê²°ì œìˆ˜ë‹¨ ì¶”ê°€</button>
                                    </div>
                                </div>
                            )}

                            {mypageSub === 'settings' && (
                                <div>
                                    <h4 className={`font-bold mb-6 text-2xl ${theme.textMain}`}>ì•± ì„¤ì •</h4>
                                    <div className="space-y-5">
                                        <div className={`flex items-center justify-between p-5 rounded-2xl ${theme.cardBg}`}>
                                            <span className={`text-lg ${theme.textMain}`}>í‘¸ì‹œ ì•Œë¦¼</span>
                                            <div className="w-14 h-8 bg-lime-400 rounded-full relative cursor-pointer"><div className="absolute right-1 top-1 w-6 h-6 bg-white rounded-full shadow-sm"></div></div>
                                        </div>
                                        <div className={`flex items-center justify-between p-5 rounded-2xl ${theme.cardBg}`}>
                                            <span className={`text-lg ${theme.textMain}`}>ìŒì„± ì•ˆë‚´ (TTS)</span>
                                            <div className="w-14 h-8 bg-gray-300 rounded-full relative cursor-pointer"><div className="absolute left-1 top-1 w-6 h-6 bg-white rounded-full shadow-sm"></div></div>
                                        </div>
                                        <div className={`flex items-center justify-between p-5 rounded-2xl ${theme.cardBg}`}>
                                            <span className={`flex items-center gap-3 text-lg ${theme.textMain}`}>ë‹¤í¬ ëª¨ë“œ</span>
                                            <div className="px-4 py-2 rounded-xl bg-gray-100 text-sm text-gray-500 font-bold">í™ˆ í™”ë©´ ìƒë‹¨ì—ì„œ ë³€ê²½ ê°€ëŠ¥</div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {mypageSub === 'myposts' && (
                                <div>
                                    <h4 className={`font-bold mb-6 text-2xl ${theme.textMain}`}>ë‚´ ê²Œì‹œê¸€</h4>
                                    <div className="space-y-5">
                                        {posts.filter(p => p.user === 'ë‚˜').length === 0 ? (
                                            <div className={`text-center py-12 text-lg ${theme.textSub}`}>ì‘ì„±í•œ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div>
                                        ) : (
                                            posts.filter(p => p.user === 'ë‚˜').map((p) => (
                                                <div key={p.id} className={`p-6 rounded-2xl ${theme.cardBg}`}>
                                                    <div className={`text-xl mb-3 ${theme.textMain}`}>{p.text}</div>
                                                    <div className={`text-base ${theme.textSub}`}>ğŸ‘ {p.likes}</div>
                                                </div>
                                            ))
                                        )}
                                    </div>
                                </div>
                            )}

                            {['neighbors', 'liked', 'achievements', 'journeymaps'].includes(mypageSub) && (
                                <div className={`text-center py-12 text-lg ${theme.textSub}`}>ê¸°ëŠ¥ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.</div>
                            )}
                        </div>
                    )}
                </div>
            );
        }

        /* ---------------- Main App ---------------- */
        function App() {
            const [isDarkMode, setIsDarkMode] = useState(false);
            const [activeTab, setActiveTab] = useState('home');
            const [showSplash, setShowSplash] = useState(true);
            const [progress, setProgress] = useState(78);

            const [isARMode, setIsARMode] = useState(false);
            const [activeMap, setActiveMap] = useState(null);
            const [arScale, setArScale] = useState(0.85);

            const [paymentModal, setPaymentModal] = useState(null);
            const [deleteModal, setDeleteModal] = useState(null);
            const [activeToast, setActiveToast] = useState(null);
            const [showVoiceGuide, setShowVoiceGuide] = useState(false); // Added state for voice guide

            const [showNotiPanel, setShowNotiPanel] = useState(false); // Notification Panel State

            const [newPostText, setNewPostText] = useState('');
            const [visibleComments, setVisibleComments] = useState({});
            const [mypageSub, setMypageSub] = useState('main');
            const [editingId, setEditingId] = useState(null);
            const [editingText, setEditingText] = useState('');

            const [dashPos, setDashPos] = React.useState({ x: 0, y: 0 });
            const dragStateRef = React.useRef({
                dragging: false,
                startX: 0,
                startY: 0,
                originX: 0,
                originY: 0,
            });

            const [missions, setMissions] = useState([
                { id: 'm1', title: '1ë¶„ íšŒìƒí•˜ê¸°', done: false },
                { id: 'm2', title: 'ì‚¬ì§„ í•œ ì¥ ì—…ë¡œë“œ', done: false },
                { id: 'm3', title: 'ì˜¤ëŠ˜ì˜ ê°ì‚¬ í•œ ì¤„ ì ê¸°', done: false }
            ]);
            const [posts, setPosts] = useState([
                { id: 100, user: 'ë‚˜', text: 'ì´ê³³ì€ ì œê°€ ì‘ì„±í•œ ì²« ë²ˆì§¸ ê¸€ì…ë‹ˆë‹¤! ìˆ˜ì • ë° ì‚­ì œ ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”.', likes: 5, comments: ['í™˜ì˜í•©ë‹ˆë‹¤!'], },
                { id: 101, user: 'ì•„ì¹¨í–‡ì‚´', text: 'ì˜¤ëŠ˜ ì•„ì¹¨ ë™ë„¤ ê³µì› ì‚°ì±…í•˜ë©° ì°ì€ ì‚¬ì§„ì…ë‹ˆë‹¤. ê³µê¸°ê°€ ì°¸ ë§‘ë„¤ìš”.', image: 'https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=800&q=80', likes: 24, comments: ['ë„ˆë¬´ ìƒì¾Œí•´ ë³´ì´ë„¤ìš”!'], },
                { id: 1, user: 'ë°•ì„ ì', text: 'ì˜¤ëŠ˜ì€ ì •ì›ì— ê½ƒì„ ì‹¬ì—ˆì–´ìš”. ì‘ì€ ì„±ì·¨ê°€ ê¸°ì˜ë„¤ìš”.', likes: 12, comments: ['ë©‹ì ¸ìš”!', 'ì €ë„ í•´ë³¼ê²Œìš”'], },
                // ì¶”ê°€ëœ ê²Œì‹œë¬¼ë“¤
                { id: 102, user: "ê¹€ì‚°ì•…", text: "ì£¼ë§ì— ê´€ì•…ì‚° ë‹¤ë…€ì™”ìŠµë‹ˆë‹¤. ë‚ ì”¨ê°€ ì •ë§ ì¢‹ë”êµ°ìš”. ì •ìƒì—ì„œ ë¨¹ëŠ” ê¹€ë°¥ ë§›ì€ ê¿€ë§›ì…ë‹ˆë‹¤.", image: "https://images.unsplash.com/photo-1551632811-561732d1e306?w=800&q=80", likes: 45, comments: ["ì €ë„ ë“±ì‚° ì¢‹ì•„í•´ìš”!", "ê±´ê°•í•´ë³´ì´ì‹­ë‹ˆë‹¤"] },
                // id: 103 removed
                { id: 104, user: "ìµœí–‰ë³µ", text: "ìš°ë¦¬ ì†ë…€ê°€ ê·¸ë ¤ì¤€ ê·¸ë¦¼ì´ì—ìš”. í• ë¨¸ë‹ˆ ì‚¬ë‘í•œë‹¤ê³  ì¨ì¤¬ë„¤ìš”. ì´ ë§›ì— ì‚´ì£  ^^", likes: 88, comments: ["ë„ˆë¬´ ì‚¬ë‘ìŠ¤ëŸ½ë„¤ìš”", "íš¨ë…€ë„¤ìš”~", "ë¶€ëŸ½ìŠµë‹ˆë‹¤"] },
                { id: 105, user: "ì •ê°•ì•„", text: "ìš°ë¦¬ ì§‘ ë§‰ë‘¥ì´ ë½€ì‚ë‘ í•œê°• ì‚°ì±… ë‚˜ì™”ì–´ìš”. ë°”ëŒì´ ì‹œì›í•©ë‹ˆë‹¤.", image: "https://images.unsplash.com/photo-1548199973-03cce0bbc87b?w=800&q=80", likes: 56, comments: ["ê°•ì•„ì§€ê°€ ë„ˆë¬´ ê·€ì—¬ì›Œìš”", "ì‚°ì±…í•˜ê¸° ì¢‹ì€ ë‚ ì”¨ì£ "] },
                { id: 106, user: "ë°•ì§€ì‹", text: "ì´ë²ˆ ì£¼ ë…ì„œ ëª¨ì„ ì±…ì€ 'ë‚˜ë¥¼ ì‚¬ë‘í•˜ëŠ” ë²•'ì…ë‹ˆë‹¤. ì¢‹ì€ êµ¬ì ˆì´ ë§ì•„ì„œ ê³µìœ í•´ë´…ë‹ˆë‹¤.", image: "https://images.unsplash.com/photo-1512820790803-83ca734da794?w=800&q=80", likes: 29, comments: ["ì €ë„ ì½ì–´ë³´ê³  ì‹¶ë„¤ìš”", "ì œëª©ë¶€í„° ì¢‹ë„¤ìš”"] },
                { id: 107, user: "ìœ ë†ë¶€", text: "ë² ë€ë‹¤ í…ƒë°­ì—ì„œ ìƒì¶”ë¥¼ ìˆ˜í™•í–ˆìŠµë‹ˆë‹¤. ì˜¤ëŠ˜ ì €ë…ì€ ì‚¼ê²¹ì‚´ íŒŒí‹° í•´ì•¼ê² ì–´ìš”!", image: "https://images.unsplash.com/photo-1530836369250-ef72a3f5cda8?w=800&q=80", likes: 67, comments: ["ì§ì ‘ í‚¤ìš°ì‹ ê±°ë¼ ë” ë§›ìˆê² ì–´ìš”", "ì‹±ì‹±í•´ ë³´ì…ë‹ˆë‹¤"] }
            ]);
            const [notifications, setNotifications] = useState([ // Notification Data
                { id: 1, text: 'ë°•ì„ ìë‹˜ì´ íšŒì›ë‹˜ì˜ ê¸€ì„ ì¢‹ì•„í•©ë‹ˆë‹¤.', time: '10ë¶„ ì „', read: false },
                { id: 2, text: 'ìƒˆë¡œìš´ ì˜¤ëŠ˜ì˜ ë¯¸ì…˜ì´ ë„ì°©í–ˆìŠµë‹ˆë‹¤!', time: '1ì‹œê°„ ì „', read: false },
            ]);

            const [likedContent, setLikedContent] = useState([]);
            const [maps, setMaps] = useState([
                { id: 'map1', title: 'ë°•ì„ ìì˜ ì„±ì¥ ë§µ', desc: 'ìš”ê°€Â·ì˜ì–´Â·ë””ì§€í„¸ ë°°ìš°ê¸° ë“± í™œë°œí•œ ì—¬ì •', img: 'https://images.unsplash.com/photo-1571019614242-c5c5dee9f50b?w=800&q=80', participants: 48, joined: false, price: '30,000â‚©', },
                { id: 'map2', title: 'ê¹€ì •í›ˆì˜ ì—¬í–‰ ê¸°ë¡', desc: 'ì „êµ­ ì—¬í–‰ì„ ê¸°ë¡í•˜ê³  ì¶”ì²œì§€ë¥¼ ê³µìœ í•©ë‹ˆë‹¤.', img: 'https://images.unsplash.com/photo-1469854523086-cc02fe5d8800?w=800&q=80', participants: 125, joined: false, },
                { id: 'map3', title: 'ì€í˜œì˜ ìš”ë¦¬ ë§µ', desc: 'ë§¤ì£¼ ìƒˆë¡œìš´ ìš”ë¦¬ ë„ì „ ë° ë ˆì‹œí”¼ ê³µìœ ', img: 'https://images.unsplash.com/photo-1495521821757-a1efb6729352?w=1000&q=80', participants: 32, joined: false, },
                { id: 'map4', title: 'ì˜ìˆ˜ì˜ ìŒì•… ì—°ìŠµ', desc: 'ë§¤ì¼ 10ë¶„ ì—°ìŠµ ëª¨ì„', img: 'https://images.unsplash.com/photo-1511379938547-c1f69419868d?w=800&q=80', participants: 9, joined: false, },
            ]);
            const [profile, setProfile] = useState({ name: 'í™ê¸¸ë™', email: 'test@example.com', level: 12 });
            const [myNeighbors, setMyNeighbors] = useState(['ë§µ_ê¿ˆë‚˜ë¬´', 'ë‚˜ë¹„íš¨ê³¼', 'ì •ë³´_ìˆ˜ì§‘ê°€']);

            useEffect(() => {
                if (!showSplash) {
                    const timer = setTimeout(() => {
                        setActiveToast('ğŸ”” ê¹€ì² ìˆ˜ë‹˜ì´ ì´ì›ƒ ì‹ ì²­ì„ ë³´ëƒˆìŠµë‹ˆë‹¤.');
                        setTimeout(() => setActiveToast(null), 3000);
                        setShowVoiceGuide(true); // Show voice guide after splash
                        const voiceGuideTimer = setTimeout(() => {
                            setShowVoiceGuide(false); // Hide voice guide after 5 seconds
                        }, 5000);
                        return () => clearTimeout(voiceGuideTimer);
                    }, 3000);
                    return () => clearTimeout(timer);
                }
            }, [showSplash]);

            const submitPost = () => { if (!newPostText.trim()) return; setPosts(prev => [{ id: Date.now(), user: 'ë‚˜', text: newPostText.trim(), likes: 0, comments: [] }, ...prev]); setNewPostText(''); setActiveTab('community'); };
            const requestDelete = (id) => setDeleteModal(id);
            const confirmDelete = () => { if (deleteModal) { setPosts(prev => prev.filter(post => post.id !== deleteModal)); setActiveToast('ğŸ—‘ï¸ ê²Œì‹œë¬¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.'); setDeleteModal(null); setTimeout(() => setActiveToast(null), 3000); } };
            const startEditPost = (post) => { setEditingId(post.id); setEditingText(post.text); };
            const cancelEditPost = () => { setEditingId(null); setEditingText(''); };
            const saveEditPost = (id) => { if (!editingText.trim()) return; setPosts(prev => prev.map(p => p.id === id ? { ...p, text: editingText } : p)); setEditingId(null); setEditingText(''); setActiveToast('âœï¸ ê²Œì‹œë¬¼ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.'); setTimeout(() => setActiveToast(null), 3000); };
            const likePost = (postId) => { setPosts(prev => prev.map(p => p.id === postId ? { ...p, likes: p.likes + 1 } : p)); if (!likedContent.includes(postId)) setLikedContent(prev => [postId, ...prev]); };
            const toggleComments = (postId) => setVisibleComments(prev => ({ ...prev, [postId]: !prev[postId] }));
            const addComment = (postId, text) => { if (!text.trim()) return; setPosts(prev => prev.map(p => p.id === postId ? { ...p, comments: [...p.comments, text] } : p)); };
            const updateProfile = (p) => { setProfile(prev => ({ ...prev, ...p })); setMypageSub('main'); };
            const joinMap = (mapId) => setMaps(prev => prev.map(m => m.id === mapId ? { ...m, joined: true, participants: m.participants + 1 } : m));
            const handleJoinClick = (map) => { if (map.joined) { setActiveMap(map); setIsARMode(true); setDashPos({ x: 0, y: 0 }); } else { if (map.price) setPaymentModal(map); else { joinMap(map.id); setActiveToast('ğŸ‰ ì—¬ì •ì— ì°¸ì—¬í–ˆìŠµë‹ˆë‹¤!'); setTimeout(() => setActiveToast(null), 3000); } } };
            const confirmPayment = () => { if (paymentModal) { joinMap(paymentModal.id); const m = paymentModal; setPaymentModal(null); setActiveToast('ğŸ’³ ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.'); setTimeout(() => setActiveToast(null), 3000); setActiveMap(m); setIsARMode(true); setDashPos({ x: 0, y: 0 }); } };
            const exitARMode = () => { setIsARMode(false); setActiveMap(null); };
            const enterARFromHome = () => { setActiveMap(null); setIsARMode(true); setDashPos({ x: 0, y: 0 }); };

            const onDashMouseDown = (e) => { if (!isARMode) return; e.preventDefault(); const startX = e.clientX; const startY = e.clientY; dragStateRef.current = { dragging: true, startX, startY, originX: dashPos.x, originY: dashPos.y, }; window.addEventListener('mousemove', onDashMouseMove); window.addEventListener('mouseup', onDashMouseUp); };
            const onDashMouseMove = (e) => { const state = dragStateRef.current; if (!state.dragging) return; const dx = e.clientX - state.startX; const dy = e.clientY - state.startY; setDashPos({ x: state.originX + dx, y: state.originY + dy, }); };
            const onDashMouseUp = () => { dragStateRef.current.dragging = false; window.removeEventListener('mousemove', onDashMouseMove); window.removeEventListener('mouseup', onDashMouseUp); };
            const onDashTouchStart = (e) => { if (!isARMode) return; const touch = e.touches[0]; dragStateRef.current = { dragging: true, startX: touch.clientX, startY: touch.clientY, originX: dashPos.x, originY: dashPos.y, }; window.addEventListener('touchmove', onDashTouchMove); window.addEventListener('touchend', onDashTouchEnd); };
            const onDashTouchMove = (e) => { const state = dragStateRef.current; if (!state.dragging) return; const touch = e.touches[0]; const dx = touch.clientX - state.startX; const dy = touch.clientY - state.startY; setDashPos({ x: state.originX + dx, y: state.originY + dy, }); };
            const onDashTouchEnd = () => { dragStateRef.current.dragging = false; window.removeEventListener('touchmove', onDashTouchMove); window.removeEventListener('touchend', onDashTouchEnd); };

            const theme = {
              bg: isDarkMode ? 'bg-[#050b14]' : 'bg-slate-50',
              panel: isDarkMode ? 'bg-slate-800/60 backdrop-blur-xl border border-white/10' : 'bg-white/80 backdrop-blur-xl border border-slate-200',
              textMain: isDarkMode ? 'text-white' : 'text-slate-900',
              textSub: isDarkMode ? 'text-gray-300' : 'text-slate-500',
              nav: isDarkMode ? 'bg-[#050b14]/90 border-white/5' : 'bg-white/90 border-slate-200',
              cardBg: isDarkMode ? 'bg-slate-800' : 'bg-white border border-slate-100',
              buttonPrimary: 'bg-gradient-to-r from-lime-400 to-emerald-400 text-black shadow-lg',
              iconInactive: isDarkMode ? 'text-gray-500' : 'text-slate-400',
            };

            return (
                <div className={`min-h-screen relative flex items-center justify-center overflow-hidden transition-colors duration-500 ${isDarkMode ? 'bg-black' : 'bg-gray-100'} ${!isARMode ? 'p-0' : 'p-4'}`}>
                    {showSplash && <SplashScreen onFinish={() => setShowSplash(false)} isDarkMode={isDarkMode} />}
                    {isARMode && <ARScene activeMap={activeMap} onExit={exitARMode} />}
                    <div className={`app-container relative flex flex-col overflow-hidden transition-all duration-700 ease-in-out ${isARMode ? 'mode-ar w-[320px] h-[600px] border-8 border-white/20 shadow-2xl' : `mode-normal w-full h-screen rounded-none border-0 ${isDarkMode ? 'bg-slate-900' : 'bg-slate-50'}`} ${theme.bg}`} style={isARMode ? { position: 'fixed', right: '20px', bottom: '20px', transform: `translate(${dashPos.x}px, ${dashPos.y}px) scale(${arScale})`, transformOrigin: 'bottom right', zIndex: 20000, margin: 0, width: '360px', height: '640px' } : {}} onMouseDown={onDashMouseDown} onTouchStart={onDashTouchStart}>
                        {isARMode && (
                            <>
                                <div className="absolute -top-12 left-0 w-full flex justify-center items-center gap-2 z-50">
                                    <div className="bg-black/60 backdrop-blur text-white px-3 py-1 rounded-full flex items-center gap-2 pointer-events-auto" onMouseDown={(e) => e.stopPropagation()} onTouchStart={(e) => e.stopPropagation()}>
                                        <span className="text-xs">í¬ê¸°</span>
                                        <input type="range" min="0.7" max="1.2" step="0.05" value={arScale} onChange={(e) => setArScale(parseFloat(e.target.value))} className="w-20 accent-lime-400 h-1" />
                                    </div>
                                </div>
                                <div className="h-6 w-full absolute top-0 left-0 z-50 flex items-center justify-center pointer-events-none"><div className="w-32 h-6 bg-black rounded-b-xl opacity-80"></div></div>
                            </>
                        )}
                        {activeToast && <div className="absolute top-8 left-4 right-4 z-[100] animate-slide-down"><div className={`p-3 rounded-xl shadow-lg flex items-center gap-3 ${theme.panel}`}><div className="w-8 h-8 bg-lime-500 rounded-full flex items-center justify-center text-white"><Bell size={16} /></div><span className={`text-sm ${theme.textMain}`}>{activeToast}</span></div></div>}
                        {paymentModal && <div className="absolute inset-0 z-[100] bg-black/60 flex items-center justify-center p-6 animate-fade-in"><div className={`w-full rounded-2xl p-6 shadow-2xl ${isDarkMode ? 'bg-slate-900 text-white' : 'bg-white text-slate-900'}`}><h3 className="text-lg font-bold mb-2 text-center">ê²°ì œ í™•ì¸</h3><p className="text-center mb-6 text-sm opacity-80"><span className="font-bold text-lime-500">{paymentModal.title}</span>ì— ì°¸ì—¬í•˜ë ¤ë©´<br /><span className="font-bold">{paymentModal.price}</span>{' '}ê²°ì œê°€ í•„ìš”í•©ë‹ˆë‹¤.</p><div className="flex gap-2"><button onClick={() => setPaymentModal(null)} className="flex-1 py-3 rounded-xl bg-gray-600 text-white text-sm">ì·¨ì†Œ</button><button onClick={confirmPayment} className="flex-1 py-3 rounded-xl bg-lime-500 text-black font-bold text-sm">ê²°ì œí•˜ê¸°</button></div></div></div>}
                        {deleteModal && <div className="absolute inset-0 z-[100] bg-black/60 flex items-center justify-center p-6 animate-fade-in"><div className={`w-full rounded-2xl p-6 shadow-2xl ${isDarkMode ? 'bg-slate-900 text-white' : 'bg-white text-slate-900'}`}><div className="w-12 h-12 rounded-full bg-red-100 text-red-500 flex items-center justify-center mb-4 mx-auto"><Trash2 size={24} /></div><h3 className="text-lg font-bold text-center mb-2">ê²Œì‹œë¬¼ ì‚­ì œ</h3><p className="text-center mb-6 text-sm opacity-80">ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?<br />ì‚­ì œëœ ë‚´ìš©ì€ ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p><div className="flex gap-2"><button onClick={() => setDeleteModal(null)} className="flex-1 py-3 rounded-xl bg-gray-600 text-white text-sm">ì·¨ì†Œ</button><button onClick={confirmDelete} className="flex-1 py-3 rounded-xl bg-red-500 text-white font-bold text-sm">ì‚­ì œí•˜ê¸°</button></div></div></div>}
                        
                        <div className="flex-1 overflow-y-auto scrollbar-hide pt-4 pb-24">
                            {activeTab === 'home' && (
                                <HomeTab 
                                    profile={profile} missions={missions} setMissions={setMissions} 
                                    progress={progress} setProgress={setProgress} 
                                    isDarkMode={isDarkMode} setIsDarkMode={setIsDarkMode} 
                                    activeToast={activeToast} 
                                    theme={theme} setActiveTab={setActiveTab} 
                                    maps={maps} handleJoinClick={handleJoinClick} 
                                    notifications={notifications}
                                    setShowNotiPanel={setShowNotiPanel}
                                    showNotiPanel={showNotiPanel}
                                    isARMode={isARMode} 
                                />
                            )}

                            {activeTab === 'journey' && (
                                <div className="p-4 pb-24 animate-fade-in">
                                    <h2 className={`text-2xl font-bold mb-6 px-2 flex items-center gap-2 pt-2 ${theme.textMain}`}>ğŸŒ ì—¬ì • íƒí—˜</h2>
                                    <div className="grid gap-5">
                                        {maps.map((map) => (
                                            <div key={map.id} className={`rounded-2xl p-4 overflow-hidden ${theme.panel}`}>
                                                <div className="relative"><img src={map.img} alt={map.title} className="w-full rounded-xl mb-4 object-cover h-56 shadow-md transition-transform duration-500 hover:scale-105" /><div className="absolute top-3 right-3 bg-black/60 backdrop-blur text-white text-xs px-2.5 py-1 rounded-lg font-bold">ì¸ê¸°</div></div>
                                                <div className="flex justify-between items-start mb-2"><div><div className={`font-bold text-xl mb-1 ${theme.textMain}`}>{map.title}</div><div className={`text-sm leading-relaxed line-clamp-2 ${theme.textSub}`}>{map.desc}</div></div></div>
                                                <div className={`mt-2 pt-3 border-t flex items-center justify-between ${isDarkMode ? 'border-white/10' : 'border-slate-100'}`}><div className={`text-sm flex items-center gap-1.5 ${theme.textSub}`}><User size={14} /> <span className={theme.textMain}>{map.participants}ëª…</span> ì°¸ì—¬ì¤‘ {map.price && <span className="text-lime-600 dark:text-lime-400 font-bold ml-1">{map.price}</span>}</div><button onClick={() => handleJoinClick(map)} className={`px-5 py-2.5 rounded-xl text-sm transition-all active:scale-95 font-bold ${map.joined ? (isDarkMode ? 'bg-slate-700 text-white' : 'bg-slate-200 text-slate-600') : 'bg-lime-400 text-black hover:bg-lime-500 shadow-lg'}`}>{map.joined ? 'ì°¸ì—¬ì¤‘' : 'í•¨ê»˜í•˜ê¸°'}</button></div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {activeTab === 'community' && (
                                <div className="p-4 animate-fade-in">
                                    <h2 className={`text-2xl font-bold mb-6 px-2 flex items-center gap-2 pt-2 ${theme.textMain}`}>ğŸŒ± ê°€ì¹˜ì˜ ì •ì›</h2>
                                    <div className={`rounded-3xl p-5 mb-6 ${theme.panel}`}>
                                        <div className="flex gap-3 mb-3"><div className="w-10 h-10 rounded-full bg-gradient-to-tr from-lime-400 to-emerald-400 flex-shrink-0 flex items-center justify-center text-black font-bold">{profile.name[0]}</div><textarea value={newPostText} onChange={(e) => setNewPostText(e.target.value)} className={`w-full border rounded-2xl p-3 text-base outline-none focus:border-lime-400 transition-colors resize-none h-20 ${isDarkMode ? 'bg-slate-800/50 border-slate-700 text-white placeholder-gray-500' : 'bg-slate-50 border-slate-200 text-slate-900 placeholder-slate-400'}`} placeholder="ì˜¤ëŠ˜ ë‚˜ëˆ„ê³  ì‹¶ì€ ì´ì•¼ê¸°ë¥¼ ì ì–´ë³´ì„¸ìš”..." /></div>
                                        <div className="flex gap-2 justify-end"><button onClick={submitPost} className={`font-bold px-6 py-2 rounded-xl transition-transform active:scale-95 ${theme.buttonPrimary}`}>ê²Œì‹œí•˜ê¸°</button></div>
                                    </div>
                                    <div className="space-y-4">
                                        {posts.map((post) => (
                                            <div key={post.id} className={`rounded-3xl p-5 ${theme.panel}`}>
                                                <div className="flex justify-between items-center mb-3">
                                                    <div className="flex items-center gap-2"><div className={`w-9 h-9 rounded-full flex items-center justify-center text-sm font-bold border ${isDarkMode ? 'bg-slate-700 text-violet-300 border-violet-500/30' : 'bg-slate-100 text-violet-600 border-violet-100'}`}>{post.user[0]}</div><div><div className={`font-bold text-sm ${theme.textMain}`}>{post.user}</div><div className={`text-xs ${theme.textSub}`}>2ì‹œê°„ ì „</div></div></div>
                                                    {post.user === 'ë‚˜' && (<div className="flex gap-2"><button onClick={() => startEditPost(post)} className="text-gray-400 hover:text-blue-500 p-1"><Edit2 size={16} /></button><button onClick={() => requestDelete(post.id)} className="text-gray-400 hover:text-red-500 p-1"><Trash2 size={16} /></button></div>)}
                                                </div>
                                                {editingId === post.id ? (
                                                    <div className="mb-4"><textarea value={editingText} onChange={(e) => setEditingText(e.target.value)} className={`w-full p-2 rounded-lg border mb-2 ${isDarkMode ? 'bg-slate-800 border-slate-600 text-white' : 'bg-white border-slate-200'}`} rows={3} /><div className="flex gap-2 justify-end"><button onClick={cancelEditPost} className={`px-3 py-1 rounded text-sm ${isDarkMode ? 'bg-slate-700 text-white' : 'bg-slate-200 text-black'}`}>ì·¨ì†Œ</button><button onClick={() => saveEditPost(post.id)} className="px-3 py-1 rounded text-sm bg-lime-500 text-white flex items-center gap-1"><Save size={14} /> ì €ì¥</button></div></div>
                                                ) : (
                                                    <><div className={`text-base mb-4 leading-relaxed pl-1 ${theme.textMain}`}>{post.text}</div>{post.image && <img src={post.image} alt="post" className="w-full rounded-2xl mb-4 object-cover h-56 border border-white/5 shadow-sm transition-transform hover:scale-[1.01]" />}</>
                                                )}
                                                <div className="flex gap-2 items-center">
                                                    <button onClick={() => likePost(post.id)} className={`flex items-center gap-1.5 text-sm px-3 py-2 rounded-xl transition-colors ${likedContent.includes(post.id) ? 'text-pink-500 bg-pink-100 dark:bg-pink-900/20' : (isDarkMode ? 'text-gray-400 bg-slate-800/50' : 'text-slate-500 bg-slate-100')}`}><Heart size={16} fill={likedContent.includes(post.id) ? "currentColor" : "none"} /> {post.likes}</button>
                                                    <button onClick={() => toggleComments(post.id)} className={`flex items-center gap-1.5 text-sm px-3 py-2 rounded-xl ${isDarkMode ? 'text-gray-400 bg-slate-800/50' : 'text-slate-500 bg-slate-100'}`}><MessageCircle size={16} /> {post.comments.length}</button>
                                                </div>
                                                {visibleComments[post.id] && (<div className={`mt-4 pt-3 border-t ${isDarkMode ? 'border-white/5' : 'border-slate-100'}`}><div className="space-y-2 mb-3">{post.comments.map((c, i) => (<div key={i} className={`text-sm p-2.5 rounded-xl border animate-fade-in ${isDarkMode ? 'text-gray-300 bg-slate-800/30 border-white/5' : 'text-slate-700 bg-slate-50 border-slate-100'}`}>{c}</div>))}</div><CommentInput onAdd={(text) => addComment(post.id, text)} isDarkMode={isDarkMode} /></div>)}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {activeTab === 'settings' && (
                                <SettingsTab 
                                    profile={profile} updateProfile={updateProfile} 
                                    isDarkMode={isDarkMode} setMypageSub={setMypageSub} 
                                    mypageSub={mypageSub} theme={theme} posts={posts} 
                                />
                            )}
                        </div>

                        <nav className={`absolute bottom-0 left-0 right-0 h-20 border-t flex justify-around items-center rounded-t-3xl backdrop-blur-md z-40 ${theme.nav}`}>
                            {[{ id: 'home', icon: Home, l: 'í™ˆ' }, { id: 'journey', icon: MapIcon, l: 'ì—¬ì •' }, { id: 'community', icon: Heart, l: 'ê°€ì¹˜' }, { id: 'settings', icon: User, l: 'ë§ˆì´' }].map((item) => (
                                <button key={item.id} onClick={() => setActiveTab(item.id)} className={`flex flex-col items-center justify-center w-full h-full transition-all duration-300 ${activeTab === item.id ? 'text-lime-500 transform -translate-y-1' : theme.iconInactive}`}>
                                    <item.icon size={28} strokeWidth={activeTab === item.id ? 2.5 : 2} />
                                    <span className={`text-sm mt-1 ${activeTab === item.id ? 'font-bold' : ''}`}>{item.l}</span>
                                </button>
                            ))}
                        </nav>

                        {!isARMode && (
                            <>
                                <button
                                    onClick={() => {
                                        setActiveToast("ğŸ¤ ìŒì„± ì¸ì‹ì„ ì‹œì‘í•©ë‹ˆë‹¤...");
                                        setTimeout(() => setActiveToast(null), 2000);
                                    }}
                                    className="absolute bottom-24 left-1/2 transform -translate-x-1/2 w-20 h-20 bg-gradient-to-r from-lime-400 to-emerald-400 rounded-full shadow-2xl flex items-center justify-center text-black z-50 hover:scale-105 active:scale-95 transition-transform animate-pulse-ring"
                                >
                                    <Mic size={36} />
                                </button>
                                {showVoiceGuide && (
                                    <div className="absolute bottom-[170px] left-1/2 transform -translate-x-1/2 bg-black/80 text-white text-sm font-bold px-4 py-2 rounded-full z-50 pointer-events-none shadow-lg border border-white/20 animate-bounce-slow whitespace-nowrap transition-opacity duration-500">
                                        ë²„íŠ¼ì„ ëˆ„ë¥´ê³  ë§ì”€í•˜ì„¸ìš” ğŸ—£ï¸
                                    </div>
                                )}
                            </>
                        )}
                        
                        {isARMode && (
                            <button onClick={exitARMode} className="absolute -top-10 right-0 bg-red-600 text-white px-4 py-2 rounded-full text-sm font-bold shadow-lg animate-fade-in z-40">AR ì¢…ë£Œ âœ•</button>
                        )}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>